{"version":3,"sources":["../src/AbstractService.js"],"names":["chalk","require","path","AbstractService","plugin","functionName","currentLayerName","stackName","getStackName","layerName","getLayerName","bucketName","getBucketName","provider","dependenceFilename","join","getBucketLayersPath","settings","dependenciesPath","zipFileKeyName","test","process","platform","replace","serviceAction","params","opts","split","service","action","checkError","request","resp","console","log","red","JSON","stringify","message","exit","compileDir","runtimeDir","cwd","module","exports"],"mappings":";;;;;;;;;;;;;;AAAA,IAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AACA,IAAMC,IAAI,GAAGD,OAAO,CAAC,MAAD,CAApB;;IAEME,e;AACJ,2BAAYC,MAAZ,EAAoB;AAAA;AAClB,SAAKA,MAAL,GAAcA,MAAd;AAEA,SAAKC,YAAL,GAAoBD,MAAM,CAACE,gBAA3B;AACA,SAAKC,SAAL,GAAiBH,MAAM,CAACI,YAAP,EAAjB;AACA,SAAKC,SAAL,GAAiBL,MAAM,CAACM,YAAP,EAAjB;AACA,SAAKC,UAAL,GAAkBP,MAAM,CAACQ,aAAP,EAAlB;AACA,SAAKC,QAAL,GAAgB,KAAKT,MAAL,CAAYS,QAA5B;AAEA,SAAKC,kBAAL,GAA0BZ,IAAI,CAACa,IAAL,CAAUX,MAAM,CAACY,mBAAP,EAAV,EAAwC,KAAKZ,MAAL,CAAYa,QAAZ,CAAqBC,gBAA7D,CAA1B;AACA,SAAKC,cAAL,aAAyBjB,IAAI,CAACa,IAAL,CAAU,KAAKX,MAAL,CAAYY,mBAAZ,EAAV,EAA6C,KAAKP,SAAlD,CAAzB;;AAEA,QAAI,OAAOW,IAAP,CAAYC,OAAO,CAACC,QAApB,CAAJ,EAAmC;AACjC,WAAKH,cAAL,GAAsB,KAAKA,cAAL,CAAoBI,OAApB,CAA4B,KAA5B,EAAmC,GAAnC,CAAtB;AACA,WAAKT,kBAAL,GAA0B,KAAKA,kBAAL,CAAwBS,OAAxB,CAAgC,KAAhC,EAAuC,GAAvC,CAA1B;AACD;AACF;;;;;uHAEgBC,a,EAAeC,M;;;;;;;;;;;;;AAAQC,gBAAAA,I,2DAAK,E;uCACjBF,aAAa,CAACG,KAAd,CAAoB,GAApB,C,oFAAnBC,O,6BAASC,M;;oBACXH,IAAI,CAACI,U;;;;;iDACD,KAAKjB,QAAL,CAAckB,OAAd,CAAsBH,OAAtB,EAA+BC,MAA/B,EAAuCJ,MAAvC,C;;;;;uBAIY,KAAKZ,QAAL,CAAckB,OAAd,CAAsBH,OAAtB,EAA+BC,MAA/B,EAAuCJ,MAAvC,C;;;AAAbO,gBAAAA,I;iDACCA,I;;;;;AAEPC,gBAAAA,OAAO,CAACC,GAAR,CAAYlC,KAAK,CAACmC,GAAN,2BAAZ;AACAF,gBAAAA,OAAO,CAACC,GAAR,uBAA2BV,aAA3B;AACAS,gBAAAA,OAAO,CAACC,GAAR,uBAA2BE,IAAI,CAACC,SAAL,CAAeZ,MAAf,CAA3B;AACAQ,gBAAAA,OAAO,CAACC,GAAR,CAAYlC,KAAK,CAACmC,GAAN,kBAAZ;AACAF,gBAAAA,OAAO,CAACC,GAAR,eAAmB,YAAEI,OAArB;AACAjB,gBAAAA,OAAO,CAACkB,IAAR,CAAa,CAAb;;;;;;;;;;;;;;;;;;yCAIiB;AAAA,kCACgB,KAAKnC,MAAL,CAAYa,QAD5B;AAAA,UACXuB,UADW,yBACXA,UADW;AAAA,UACCC,UADD,yBACCA,UADD;AAEnB,aAAOvC,IAAI,CAACa,IAAL,CAAUM,OAAO,CAACqB,GAAR,EAAV,EAAyBF,UAAzB,EAAqC,QAArC,EAA+CC,UAA/C,CAAP;AAAkE;AACnE;;;;;AAGHE,MAAM,CAACC,OAAP,GAAiBzC,eAAjB","sourcesContent":["const chalk = require('chalk');\nconst path = require('path');\n\nclass AbstractService {\n  constructor(plugin) {\n    this.plugin = plugin;\n\n    this.functionName = plugin.currentLayerName;\n    this.stackName = plugin.getStackName();\n    this.layerName = plugin.getLayerName();\n    this.bucketName = plugin.getBucketName();\n    this.provider = this.plugin.provider;\n\n    this.dependenceFilename = path.join(plugin.getBucketLayersPath(), this.plugin.settings.dependenciesPath);\n    this.zipFileKeyName = `${path.join(this.plugin.getBucketLayersPath(), this.layerName)}.zip`;\n\n    if (/^win/.test(process.platform)) {\n      this.zipFileKeyName = this.zipFileKeyName.replace(/\\\\/g, '/');\n      this.dependenceFilename = this.dependenceFilename.replace(/\\\\/g, '/');\n    }\n  }\n\n  async awsRequest(serviceAction, params, opts={}) {\n    const [service, action] = serviceAction.split(':');\n    if (!opts.checkError) {\n      return this.provider.request(service, action, params);\n    }\n\n    try {\n      const resp = await this.provider.request(service, action, params);\n      return resp;\n    }catch(e) {\n      console.log(chalk.red(`ServerlessLayers error:`));\n      console.log(`    Action: ${serviceAction}`);\n      console.log(`    Params: ${JSON.stringify(params)}`);\n      console.log(chalk.red(`AWS SDK error:`));\n      console.log(`    ${e.message}`);\n      process.exit(1);\n    }\n  }\n\n  getLayerPackageDir() {\n    const { compileDir, runtimeDir } = this.plugin.settings;\n    return path.join(process.cwd(), compileDir, 'layers', runtimeDir);;\n  }\n}\n\nmodule.exports = AbstractService\n"],"file":"AbstractService.js"}