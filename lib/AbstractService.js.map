{"version":3,"file":"AbstractService.js","names":["chalk","require","path","AbstractService","plugin","functionName","currentLayerName","stackName","getStackName","layerName","getLayerName","bucketName","getBucketName","bucketEncryption","getBucketEncryptiom","provider","dependenceFilename","join","getBucketLayersPath","settings","dependenciesPath","zipFileKeyName","test","process","platform","replace","serviceAction","params","opts","split","service","action","checkError","request","resp","console","log","red","JSON","stringify","message","exit","compileDir","runtimeDir","cwd","module","exports"],"sources":["../src/AbstractService.js"],"sourcesContent":["const chalk = require('chalk');\nconst path = require('path');\n\nclass AbstractService {\n  constructor(plugin) {\n    this.plugin = plugin;\n\n    this.functionName = plugin.currentLayerName;\n    this.stackName = plugin.getStackName();\n    this.layerName = plugin.getLayerName();\n    this.bucketName = plugin.getBucketName();\n    this.bucketEncryption = plugin.getBucketEncryptiom();\n    this.provider = this.plugin.provider;\n\n    this.dependenceFilename = path.join(plugin.getBucketLayersPath(), this.plugin.settings.dependenciesPath);\n    this.zipFileKeyName = `${path.join(this.plugin.getBucketLayersPath(), this.layerName)}.zip`;\n\n    if (/^win/.test(process.platform)) {\n      this.zipFileKeyName = this.zipFileKeyName.replace(/\\\\/g, '/');\n      this.dependenceFilename = this.dependenceFilename.replace(/\\\\/g, '/');\n    }\n  }\n\n  async awsRequest(serviceAction, params, opts={}) {\n    const [service, action] = serviceAction.split(':');\n    if (!opts.checkError) {\n      return this.provider.request(service, action, params);\n    }\n\n    try {\n      const resp = await this.provider.request(service, action, params);\n      return resp;\n    }catch(e) {\n      console.log(chalk.red(`ServerlessLayers error:`));\n      console.log(`    Action: ${serviceAction}`);\n      console.log(`    Params: ${JSON.stringify(params)}`);\n      console.log(chalk.red(`AWS SDK error:`));\n      console.log(`    ${e.message}`);\n      process.exit(1);\n    }\n  }\n\n  getLayerPackageDir() {\n    const { compileDir, runtimeDir } = this.plugin.settings;\n    return path.join(process.cwd(), compileDir, 'layers', runtimeDir);;\n  }\n}\n\nmodule.exports = AbstractService\n"],"mappings":";;;;;;;;AAAA,IAAMA,KAAK,GAAGC,OAAO,CAAC,OAAO,CAAC;AAC9B,IAAMC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;AAAC,IAEvBE,eAAe;EACnB,yBAAYC,MAAM,EAAE;IAAA;IAClB,IAAI,CAACA,MAAM,GAAGA,MAAM;IAEpB,IAAI,CAACC,YAAY,GAAGD,MAAM,CAACE,gBAAgB;IAC3C,IAAI,CAACC,SAAS,GAAGH,MAAM,CAACI,YAAY,EAAE;IACtC,IAAI,CAACC,SAAS,GAAGL,MAAM,CAACM,YAAY,EAAE;IACtC,IAAI,CAACC,UAAU,GAAGP,MAAM,CAACQ,aAAa,EAAE;IACxC,IAAI,CAACC,gBAAgB,GAAGT,MAAM,CAACU,mBAAmB,EAAE;IACpD,IAAI,CAACC,QAAQ,GAAG,IAAI,CAACX,MAAM,CAACW,QAAQ;IAEpC,IAAI,CAACC,kBAAkB,GAAGd,IAAI,CAACe,IAAI,CAACb,MAAM,CAACc,mBAAmB,EAAE,EAAE,IAAI,CAACd,MAAM,CAACe,QAAQ,CAACC,gBAAgB,CAAC;IACxG,IAAI,CAACC,cAAc,aAAMnB,IAAI,CAACe,IAAI,CAAC,IAAI,CAACb,MAAM,CAACc,mBAAmB,EAAE,EAAE,IAAI,CAACT,SAAS,CAAC,SAAM;IAE3F,IAAI,MAAM,CAACa,IAAI,CAACC,OAAO,CAACC,QAAQ,CAAC,EAAE;MACjC,IAAI,CAACH,cAAc,GAAG,IAAI,CAACA,cAAc,CAACI,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC;MAC7D,IAAI,CAACT,kBAAkB,GAAG,IAAI,CAACA,kBAAkB,CAACS,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC;IACvE;EACF;EAAC;IAAA;IAAA;MAAA,gGAED,iBAAiBC,aAAa,EAAEC,MAAM;QAAA;UAAA;UAAA;UAAA;UAAA;UAAA;UAAA;QAAA;UAAA;YAAA;cAAEC,IAAI,2DAAC,CAAC,CAAC;cAAA,uBACnBF,aAAa,CAACG,KAAK,CAAC,GAAG,CAAC,oFAA3CC,OAAO,6BAAEC,MAAM;cAAA,IACjBH,IAAI,CAACI,UAAU;gBAAA;gBAAA;cAAA;cAAA,iCACX,IAAI,CAACjB,QAAQ,CAACkB,OAAO,CAACH,OAAO,EAAEC,MAAM,EAAEJ,MAAM,CAAC;YAAA;cAAA;cAAA;cAAA,OAIlC,IAAI,CAACZ,QAAQ,CAACkB,OAAO,CAACH,OAAO,EAAEC,MAAM,EAAEJ,MAAM,CAAC;YAAA;cAA3DO,IAAI;cAAA,iCACHA,IAAI;YAAA;cAAA;cAAA;cAEXC,OAAO,CAACC,GAAG,CAACpC,KAAK,CAACqC,GAAG,2BAA2B,CAAC;cACjDF,OAAO,CAACC,GAAG,uBAAgBV,aAAa,EAAG;cAC3CS,OAAO,CAACC,GAAG,uBAAgBE,IAAI,CAACC,SAAS,CAACZ,MAAM,CAAC,EAAG;cACpDQ,OAAO,CAACC,GAAG,CAACpC,KAAK,CAACqC,GAAG,kBAAkB,CAAC;cACxCF,OAAO,CAACC,GAAG,eAAQ,YAAEI,OAAO,EAAG;cAC/BjB,OAAO,CAACkB,IAAI,CAAC,CAAC,CAAC;YAAC;YAAA;cAAA;UAAA;QAAA;MAAA,CAEnB;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA,OAED,8BAAqB;MACnB,4BAAmC,IAAI,CAACrC,MAAM,CAACe,QAAQ;QAA/CuB,UAAU,yBAAVA,UAAU;QAAEC,UAAU,yBAAVA,UAAU;MAC9B,OAAOzC,IAAI,CAACe,IAAI,CAACM,OAAO,CAACqB,GAAG,EAAE,EAAEF,UAAU,EAAE,QAAQ,EAAEC,UAAU,CAAC;MAAC;IACpE;EAAC;EAAA;AAAA;AAGHE,MAAM,CAACC,OAAO,GAAG3C,eAAe"}